#!/usr/bin/env bash
# [MISE] description="Find files or text (combined fd/rg)"
# [MISE] dir="{{cwd}}"

# Usage:
#   fd [pattern]                    - Find files (auto-detects glob vs regex)
#   fd [pattern] [path]             - Find files starting from path
#   fd text [pattern]               - Search for text in all files
#   fd text [pattern] [glob_or_path] - Search for text with glob filter or from path

if [[ "$1" == "text" ]]; then
    shift
    text_pattern="$1"
    glob_or_path="$2"

    if [[ -z "$text_pattern" ]]; then
        echo "Error: text pattern required"
        echo "Usage: fd text [pattern] [glob_or_path]"
        exit 1
    fi

    if [[ -n "$glob_or_path" ]]; then
        # Auto-detect glob patterns (contain *, ?, [, or ])
        if [[ "$glob_or_path" =~ [\*\?\[\]] ]]; then
            # Search for text in files matching glob
            command rg --hidden --no-ignore --glob "$glob_or_path" "$text_pattern" || true
        else
            # Search for text starting from path
            command rg --hidden --no-ignore "$text_pattern" "$glob_or_path" || true
        fi
    else
        # Search for text in all files
        command rg --hidden --no-ignore "$text_pattern" || true
    fi
else
    # File search with auto-detection of glob vs regex
    pattern="$1"
    starting_path="$2"

    if [[ -z "$pattern" ]]; then
        echo "Error: pattern required"
        echo "Usage: fd [pattern] [path]"
        exit 1
    fi

    # Auto-detect glob patterns (contain *, ?, [, or ])
    if [[ "$pattern" =~ [\*\?\[\]] ]]; then
        command fd --hidden --no-ignore --glob "$pattern" ${starting_path:+"$starting_path"}
    else
        command fd --hidden --no-ignore "$pattern" ${starting_path:+"$starting_path"}
    fi
fi
