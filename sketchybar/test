#!/usr/bin/env zsh

unmatched_items() {
  local source=("${(s/ /)1}")  # Split the first argument into an array
  local targets=("${(s/ /)${2}}") # Split the second argument into an array

  local result=""
  local -A source_count
  local -A target_count

  # Count occurrences in source
  for s_item in "${source[@]}"; do
    ((source_count["$s_item"]++))  # Use quotes around associative array keys
  done

  # Count occurrences in targets
  for target in "${targets[@]}"; do
    local item=${target##*.}
    ((target_count["$item"]++))  # Use quotes around associative array keys
  done

  # Find unmatched items
  for target in "${targets[@]}"; do
    local item=${target##*.}
    if ((target_count["$item"] > source_count["$item"])); then  # Use quotes around associative array keys
      result+="$target "
      ((target_count["$item"]--))  # Use quotes around associative array keys
    fi
  done

  echo "$result"
}


fixed=("WezTerm" "WezTerm")
variable=("window.2.3.WezTerm" "window.2.4.WezTerm" "abc")

unmatched_items "${fixed}" "${variable}"
